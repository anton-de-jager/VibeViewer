"use strict";(self.webpackChunkvibeViewer=self.webpackChunkvibeViewer||[]).push([[527],{527:(H,v,l)=>{l.r(v),l.d(v,{SubscriptionModule:()=>R});var m=l(2510),S=l(9209),V=l(2340);class o{constructor(){this._dataLength=0,this._bufferLength=0,this._state=new Int32Array(4),this._buffer=new ArrayBuffer(68),this._buffer8=new Uint8Array(this._buffer,0,68),this._buffer32=new Uint32Array(this._buffer,0,17),this.start()}static hashStr(a,r=!1){return this.onePassHasher.start().appendStr(a).end(r)}static hashAsciiStr(a,r=!1){return this.onePassHasher.start().appendAsciiStr(a).end(r)}static _hex(a){const r=o.hexChars,e=o.hexOut;let t,s,i,h;for(h=0;h<4;h+=1)for(s=8*h,t=a[h],i=0;i<8;i+=2)e[s+1+i]=r.charAt(15&t),t>>>=4,e[s+0+i]=r.charAt(15&t),t>>>=4;return e.join("")}static _md5cycle(a,r){let e=a[0],t=a[1],s=a[2],i=a[3];e+=(t&s|~t&i)+r[0]-680876936|0,e=(e<<7|e>>>25)+t|0,i+=(e&t|~e&s)+r[1]-389564586|0,i=(i<<12|i>>>20)+e|0,s+=(i&e|~i&t)+r[2]+606105819|0,s=(s<<17|s>>>15)+i|0,t+=(s&i|~s&e)+r[3]-1044525330|0,t=(t<<22|t>>>10)+s|0,e+=(t&s|~t&i)+r[4]-176418897|0,e=(e<<7|e>>>25)+t|0,i+=(e&t|~e&s)+r[5]+1200080426|0,i=(i<<12|i>>>20)+e|0,s+=(i&e|~i&t)+r[6]-1473231341|0,s=(s<<17|s>>>15)+i|0,t+=(s&i|~s&e)+r[7]-45705983|0,t=(t<<22|t>>>10)+s|0,e+=(t&s|~t&i)+r[8]+1770035416|0,e=(e<<7|e>>>25)+t|0,i+=(e&t|~e&s)+r[9]-1958414417|0,i=(i<<12|i>>>20)+e|0,s+=(i&e|~i&t)+r[10]-42063|0,s=(s<<17|s>>>15)+i|0,t+=(s&i|~s&e)+r[11]-1990404162|0,t=(t<<22|t>>>10)+s|0,e+=(t&s|~t&i)+r[12]+1804603682|0,e=(e<<7|e>>>25)+t|0,i+=(e&t|~e&s)+r[13]-40341101|0,i=(i<<12|i>>>20)+e|0,s+=(i&e|~i&t)+r[14]-1502002290|0,s=(s<<17|s>>>15)+i|0,t+=(s&i|~s&e)+r[15]+1236535329|0,t=(t<<22|t>>>10)+s|0,e+=(t&i|s&~i)+r[1]-165796510|0,e=(e<<5|e>>>27)+t|0,i+=(e&s|t&~s)+r[6]-1069501632|0,i=(i<<9|i>>>23)+e|0,s+=(i&t|e&~t)+r[11]+643717713|0,s=(s<<14|s>>>18)+i|0,t+=(s&e|i&~e)+r[0]-373897302|0,t=(t<<20|t>>>12)+s|0,e+=(t&i|s&~i)+r[5]-701558691|0,e=(e<<5|e>>>27)+t|0,i+=(e&s|t&~s)+r[10]+38016083|0,i=(i<<9|i>>>23)+e|0,s+=(i&t|e&~t)+r[15]-660478335|0,s=(s<<14|s>>>18)+i|0,t+=(s&e|i&~e)+r[4]-405537848|0,t=(t<<20|t>>>12)+s|0,e+=(t&i|s&~i)+r[9]+568446438|0,e=(e<<5|e>>>27)+t|0,i+=(e&s|t&~s)+r[14]-1019803690|0,i=(i<<9|i>>>23)+e|0,s+=(i&t|e&~t)+r[3]-187363961|0,s=(s<<14|s>>>18)+i|0,t+=(s&e|i&~e)+r[8]+1163531501|0,t=(t<<20|t>>>12)+s|0,e+=(t&i|s&~i)+r[13]-1444681467|0,e=(e<<5|e>>>27)+t|0,i+=(e&s|t&~s)+r[2]-51403784|0,i=(i<<9|i>>>23)+e|0,s+=(i&t|e&~t)+r[7]+1735328473|0,s=(s<<14|s>>>18)+i|0,t+=(s&e|i&~e)+r[12]-1926607734|0,t=(t<<20|t>>>12)+s|0,e+=(t^s^i)+r[5]-378558|0,e=(e<<4|e>>>28)+t|0,i+=(e^t^s)+r[8]-2022574463|0,i=(i<<11|i>>>21)+e|0,s+=(i^e^t)+r[11]+1839030562|0,s=(s<<16|s>>>16)+i|0,t+=(s^i^e)+r[14]-35309556|0,t=(t<<23|t>>>9)+s|0,e+=(t^s^i)+r[1]-1530992060|0,e=(e<<4|e>>>28)+t|0,i+=(e^t^s)+r[4]+1272893353|0,i=(i<<11|i>>>21)+e|0,s+=(i^e^t)+r[7]-155497632|0,s=(s<<16|s>>>16)+i|0,t+=(s^i^e)+r[10]-1094730640|0,t=(t<<23|t>>>9)+s|0,e+=(t^s^i)+r[13]+681279174|0,e=(e<<4|e>>>28)+t|0,i+=(e^t^s)+r[0]-358537222|0,i=(i<<11|i>>>21)+e|0,s+=(i^e^t)+r[3]-722521979|0,s=(s<<16|s>>>16)+i|0,t+=(s^i^e)+r[6]+76029189|0,t=(t<<23|t>>>9)+s|0,e+=(t^s^i)+r[9]-640364487|0,e=(e<<4|e>>>28)+t|0,i+=(e^t^s)+r[12]-421815835|0,i=(i<<11|i>>>21)+e|0,s+=(i^e^t)+r[15]+530742520|0,s=(s<<16|s>>>16)+i|0,t+=(s^i^e)+r[2]-995338651|0,t=(t<<23|t>>>9)+s|0,e+=(s^(t|~i))+r[0]-198630844|0,e=(e<<6|e>>>26)+t|0,i+=(t^(e|~s))+r[7]+1126891415|0,i=(i<<10|i>>>22)+e|0,s+=(e^(i|~t))+r[14]-1416354905|0,s=(s<<15|s>>>17)+i|0,t+=(i^(s|~e))+r[5]-57434055|0,t=(t<<21|t>>>11)+s|0,e+=(s^(t|~i))+r[12]+1700485571|0,e=(e<<6|e>>>26)+t|0,i+=(t^(e|~s))+r[3]-1894986606|0,i=(i<<10|i>>>22)+e|0,s+=(e^(i|~t))+r[10]-1051523|0,s=(s<<15|s>>>17)+i|0,t+=(i^(s|~e))+r[1]-2054922799|0,t=(t<<21|t>>>11)+s|0,e+=(s^(t|~i))+r[8]+1873313359|0,e=(e<<6|e>>>26)+t|0,i+=(t^(e|~s))+r[15]-30611744|0,i=(i<<10|i>>>22)+e|0,s+=(e^(i|~t))+r[6]-1560198380|0,s=(s<<15|s>>>17)+i|0,t+=(i^(s|~e))+r[13]+1309151649|0,t=(t<<21|t>>>11)+s|0,e+=(s^(t|~i))+r[4]-145523070|0,e=(e<<6|e>>>26)+t|0,i+=(t^(e|~s))+r[11]-1120210379|0,i=(i<<10|i>>>22)+e|0,s+=(e^(i|~t))+r[2]+718787259|0,s=(s<<15|s>>>17)+i|0,t+=(i^(s|~e))+r[9]-343485551|0,t=(t<<21|t>>>11)+s|0,a[0]=e+a[0]|0,a[1]=t+a[1]|0,a[2]=s+a[2]|0,a[3]=i+a[3]|0}start(){return this._dataLength=0,this._bufferLength=0,this._state.set(o.stateIdentity),this}appendStr(a){const r=this._buffer8,e=this._buffer32;let s,i,t=this._bufferLength;for(i=0;i<a.length;i+=1){if(s=a.charCodeAt(i),s<128)r[t++]=s;else if(s<2048)r[t++]=192+(s>>>6),r[t++]=63&s|128;else if(s<55296||s>56319)r[t++]=224+(s>>>12),r[t++]=s>>>6&63|128,r[t++]=63&s|128;else{if(s=1024*(s-55296)+(a.charCodeAt(++i)-56320)+65536,s>1114111)throw new Error("Unicode standard supports code points up to U+10FFFF");r[t++]=240+(s>>>18),r[t++]=s>>>12&63|128,r[t++]=s>>>6&63|128,r[t++]=63&s|128}t>=64&&(this._dataLength+=64,o._md5cycle(this._state,e),t-=64,e[0]=e[16])}return this._bufferLength=t,this}appendAsciiStr(a){const r=this._buffer8,e=this._buffer32;let s,t=this._bufferLength,i=0;for(;;){for(s=Math.min(a.length-i,64-t);s--;)r[t++]=a.charCodeAt(i++);if(t<64)break;this._dataLength+=64,o._md5cycle(this._state,e),t=0}return this._bufferLength=t,this}appendByteArray(a){const r=this._buffer8,e=this._buffer32;let s,t=this._bufferLength,i=0;for(;;){for(s=Math.min(a.length-i,64-t);s--;)r[t++]=a[i++];if(t<64)break;this._dataLength+=64,o._md5cycle(this._state,e),t=0}return this._bufferLength=t,this}getState(){const a=this._state;return{buffer:String.fromCharCode.apply(null,Array.from(this._buffer8)),buflen:this._bufferLength,length:this._dataLength,state:[a[0],a[1],a[2],a[3]]}}setState(a){const r=a.buffer,e=a.state,t=this._state;let s;for(this._dataLength=a.length,this._bufferLength=a.buflen,t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],s=0;s<r.length;s+=1)this._buffer8[s]=r.charCodeAt(s)}end(a=!1){const r=this._bufferLength,e=this._buffer8,t=this._buffer32,s=1+(r>>2);this._dataLength+=r;const i=8*this._dataLength;if(e[r]=128,e[r+1]=e[r+2]=e[r+3]=0,t.set(o.buffer32Identity.subarray(s),s),r>55&&(o._md5cycle(this._state,t),t.set(o.buffer32Identity)),i<=4294967295)t[14]=i;else{const h=i.toString(16).match(/(.*?)(.{0,8})$/);if(null===h)return;const b=parseInt(h[2],16),y=parseInt(h[1],16)||0;t[14]=b,t[15]=y}return o._md5cycle(this._state,t),a?this._state:o._hex(this._state)}}if(o.stateIdentity=new Int32Array([1732584193,-271733879,-1732584194,271733878]),o.buffer32Identity=new Int32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),o.hexChars="0123456789abcdef",o.hexOut=[],o.onePassHasher=new o,"5d41402abc4b2a76b9719d911017c592"!==o.hashStr("hello"))throw new Error("Md5 self test failed.");var I=l(5938),P=l(4327),n=l(4650),A=l(7495),C=l(3071),_=l(1299),F=l(7420),x=l(5830),L=l(6429),U=l(4006),N=l(5470),w=l(6895),M=l(4859);function D(c,a){if(1&c){const r=n.EpF();n.TgZ(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",5),n._uU(5,"Complete Subscription"),n.qZA(),n._UZ(6,"img",6),n.qZA(),n._UZ(7,"hr"),n.TgZ(8,"button",7),n.NdJ("click",function(){n.CHM(r);const t=n.oxw();return n.KtG(t.subscribe())}),n._uU(9,"Re-Send Subscription Email "),n.qZA()()()()}2&c&&(n.xp6(8),n.Q6J("color","primary"))}let Y=(()=>{class c{constructor(r,e,t,s,i,h,b,y,E,z,Q,J,O){this._changeDetectorRef=r,this._activatedRoute=e,this._userService=t,this.userService=s,this.variableService=i,this.sharedService=h,this.apiService=b,this.router=y,this.eventEmitterService=E,this._formBuilder=z,this.dialog=Q,this.payPal=J,this.payPalScriptService=O,this.planId="",this.loading=!0,this.paymentAmount="19.80",this.currency="USD",this.currencyIcon="$",this.diff=0,this.htmlForm="",this.plans=[{days:-1,planId:"P-1K5407762U2173306MNR3Q5Y"},{days:0,planId:"P-83N86231GP6587744MNBZB3A"},{days:1,planId:"P-3SF73423331654634MNVVJ3I"},{days:2,planId:"P-8VT64768BR920974VMNVUFGQ"},{days:3,planId:"P-9LF91819CX3489048MNVUZ7A"},{days:4,planId:"P-57W97311A1220733SMNVU2LI"},{days:5,planId:"P-4PM82844110085344MNVU2YQ"},{days:6,planId:"P-6DX963510L621991YMNVU3EA"},{days:7,planId:"P-8JP843866E437883CMNVU3QA"},{days:8,planId:"P-76L33439CJ347800MMNVU33Y"},{days:9,planId:"P-6HE13823GS986644HMNVU4FY"},{days:10,planId:"P-2RD29903B9173910FMNVU4QY"},{days:11,planId:"P-3U018777TX070930DMNVU42Y"},{days:12,planId:"P-4A205622W7428761EMNVU5HQ"},{days:13,planId:"P-3PF697466Y197152WMNVU5TQ"},{days:14,planId:"P-10G678088X463002LMNVU56Q"},{days:15,planId:"P-0CR69401XL344871RMNVU6JI"},{days:16,planId:"P-22S06318UY4993327MNVU6YQ"},{days:17,planId:"P-8JX22760VL5215841MNVU7EA"},{days:18,planId:"P-59L376033J481960GMNVU7QA"},{days:19,planId:"P-3GC212464H532413NMNVU74I"},{days:20,planId:"P-2BE94003JS8095258MNVVAIY"},{days:21,planId:"P-09L14851NT6619348MNVVAUA"},{days:22,planId:"P-8Y842349JE584524PMNVVBAQ"},{days:23,planId:"P-6BN95877PK247162LMNVVBLY"},{days:24,planId:"P-6TA11853NL2768615MNVVBWI"},{days:25,planId:"P-7WM17978WB5266911MNVVCCQ"},{days:26,planId:"P-4J1094991X7807925MNVVCQA"},{days:27,planId:"P-2FD39085WC119932BMNVVC3Y"},{days:28,planId:"P-2DG340408P825574LMNVVDHI"},{days:29,planId:"P-7KD64724WC579863LMNVVDVY"},{days:30,planId:"P-1LN556972X7687914MNVVECI"}],this.days=(u,d)=>{let f=u.getTime()-d.getTime();return Math.ceil(f/864e5)},this.generateSignature=(u,d=null)=>{let f="";for(let p in u)u.hasOwnProperty(p)&&""!==u[p]&&(f+=`${p}=${encodeURIComponent(u[p].trim()).replace(/%20/g,"+")}&`);let g=f.slice(0,-1);return null!==d&&(g+=`&passphrase=${encodeURIComponent(d.trim()).replace(/%20/g,"+")}`),o.hashStr(g)},setTimeout(()=>{this.eventEmitterService.onChangePage("subscription")},500)}ngOnInit(){this._userService.get().subscribe(r=>{this.user=r,this.user||(localStorage.removeItem("AT"),localStorage.removeItem("RT"),localStorage.removeItem("ID"),this.router.navigateByUrl("/sign-in"))},r=>{localStorage.removeItem("AT"),localStorage.removeItem("RT"),localStorage.removeItem("ID");const e=this._activatedRoute.snapshot.queryParamMap.get("redirectURL")||"/home";this.router.navigateByUrl(e)})}dateChanged(r){this.diff=this.days(new Date(r.value),new Date),this.createButtons()}createButtons(){this.loading=!0,this.payPalConfig={currency:"USD",clientId:V.N.paypalClientId,vault:"true",intent:"subscription",createSubscriptionOnClient:r=>({plan_id:this.plans.find(e=>e.days==this.diff).planId,custom_id:this.user.id.toString()}),advanced:{commit:"true"},style:{label:"subscribe",layout:"vertical",shape:"pill"},onApprove:(r,e)=>{this.apiService.activate({userId:this.user.id.toString(),orderId:r.orderID,subscriptionId:r.subscriptionID,price:19.8}).subscribe(t=>{this.userService.getUserInfo().subscribe({next:s=>{this.user=s,this.eventEmitterService.onChangeUser(this.user),this._changeDetectorRef.markForCheck(),this.user||(localStorage.removeItem("AT"),localStorage.removeItem("RT"),localStorage.removeItem("ID"),this.router.navigateByUrl("/sign-in")),this.eventEmitterService.onChangePage("subscription"),this.router.navigateByUrl("dashboard")},error:()=>{localStorage.removeItem("AT"),localStorage.removeItem("RT"),localStorage.removeItem("ID")}})})},onClientAuthorization:r=>{console.log("onClientAuthorization - you should probably inform your server about completed transaction at this point",r)},onCancel:(r,e)=>{console.log("OnCancel",r,e)},onError:r=>{console.log("OnError",r)},onClick:(r,e)=>{console.log("onClick",r,e)}},setTimeout(()=>{this.loading=!1},200)}ngAfterViewInit(){}subscribe(){this.apiService.submitSubscription(this.user.id).subscribe(r=>{const e=new I.vA;e.data={title:"Email Sent",body:"A subscription link has been sent to <b>"+this.user.email+"</b>"},e.autoFocus=!0,e.disableClose=!0,e.hasBackdrop=!0,e.ariaLabel="fffff",e.width="100vw",e.maxWidth="800px",e.panelClass="full-screen-modal",this.dialog.open(P.x,e)})}getFormData(){let r=new Date;r.setDate(r.getDate()+14);const e=[];return e.merchant_id="15252850",e.merchant_key="8n1rbtdsbz6io",e.return_url="https://vibeviewer.com/subscription-success",e.cancel_url="https://vibeviewer.com/subscription-cancel",e.notify_url="https://luvirosapi.com:1880/vibeviewer/api/notify",e.m_payment_id=this.user.id,e.amount="350.00",e.item_name="Vibe Viewer Subscription",e.subscription_type="1",e.recurring_amount="350.00",e.frequency="3",e.cycles="0",e.email_address=this.user.email,e.signature=this.generateSignature(e,"ThisIsMyVibeViewerPassphrase007"),e}buildForm(){let r=new Date;r.setDate(r.getDate()+14);const e=[];e.merchant_id="15252850",e.merchant_key="8n1rbtdsbz6io",e.return_url="https://vibeviewer.com/subscription-success",e.cancel_url="https://vibeviewer.com/subscription-cancel",e.notify_url="https://luvirosapi.com:1880/vibeviewer/api/notify",e.m_payment_id=this.user.id,e.amount="350.00",e.item_name="Vibe Viewer Subscription",e.subscription_type="1",e.recurring_amount="350.00",e.frequency="3",e.cycles="0",e.email_address=this.user.email,e.signature=this.generateSignature(e,"ThisIsMyVibeViewerPassphrase007"),this.htmlForm='<form action="https://www.payfast.co.za/eng/process" method="post">';for(let s in e)if(e.hasOwnProperty(s)){let i=e[s];""!==i&&(this.htmlForm+=`<input name="${s}" type="hidden" value="${i.trim()}" />`)}this.htmlForm+='<input type="submit" value="Subscribe" /></form>',console.log(this.htmlForm)}}return c.\u0275fac=function(r){return new(r||c)(n.Y36(n.sBO),n.Y36(m.gz),n.Y36(A.K),n.Y36(C.K),n.Y36(_.S),n.Y36(F.F),n.Y36(x.s),n.Y36(m.F0),n.Y36(L.Y),n.Y36(U.qu),n.Y36(I.uw),n.Y36(S.lg),n.Y36(N.ab))},c.\u0275cmp=n.Xpm({type:c,selectors:[["subscription"]],decls:1,vars:1,consts:[["class","flex flex-col flex-auto items-center sm:justify-center min-w-0",4,"ngIf"],[1,"flex","flex-col","flex-auto","items-center","sm:justify-center","min-w-0"],[1,"w-full","sm:w-auto","py-8","px-4","sm:p-12","sm:rounded-2xl","sm:shadow","sm:bg-card"],[1,"w-full","max-w-80","sm:w-80","mx-auto","sm:mx-0"],[1,"inline-flex","items-center","justify-between","w-full","mt-1.5"],[1,"text-4xl","font-extrabold","tracking-tight","leading-tight"],["src","assets/images/logo/logo.png",1,"auth-logo"],["mat-flat-button","","type","button",1,"ml-4",3,"color","click"]],template:function(r,e){1&r&&n.YNc(0,D,10,1,"div",0),2&r&&n.Q6J("ngIf",e.user)},dependencies:[w.O5,M.lW],encapsulation:2}),c})();var B=l(5524);const T=[{path:"",component:Y}];let R=(()=>{class c{}return c.\u0275fac=function(r){return new(r||c)},c.\u0275mod=n.oAB({type:c}),c.\u0275inj=n.cJS({imports:[m.Bz.forChild(T),B.m]}),c})()}}]);